<!DOCTYPE html>
<html lang="en-us" dir="ltr" itemscope itemtype="http://schema.org/Article" data-r-output-format="html">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="generator" content="Hugo 0.148.2">
    <meta name="generator" content="Relearn 8.0.0+9803d5122ebb3276acea823f476e9eb44f607862">
    <meta name="description" content="With the existing API Key policy, we can control the incoming requests. However, the policies implemented by the other plugins are the same regardless the consumer.
In this section, we are going to define specific Rate Limiting policies for each Consumer represented by its API Key.
Kong Consumer Policies Itâ€™s important then to be able to define specific policies for each one of these consumers. For example, it would be great to define Rate Limiting policies for different consumers like this:">
    <meta name="author" content="">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="AI Rate Limiting Advanced plugin :: API Management with Kong Konnect">
    <meta name="twitter:description" content="With the existing API Key policy, we can control the incoming requests. However, the policies implemented by the other plugins are the same regardless the consumer.
In this section, we are going to define specific Rate Limiting policies for each Consumer represented by its API Key.
Kong Consumer Policies Itâ€™s important then to be able to define specific policies for each one of these consumers. For example, it would be great to define Rate Limiting policies for different consumers like this:">
    <meta property="og:url" content="http://localhost:1313/16-ai-gateway/17-use-cases/158-rate-limiting/index.html">
    <meta property="og:site_name" content="API Management with Kong Konnect">
    <meta property="og:title" content="AI Rate Limiting Advanced plugin :: API Management with Kong Konnect">
    <meta property="og:description" content="With the existing API Key policy, we can control the incoming requests. However, the policies implemented by the other plugins are the same regardless the consumer.
In this section, we are going to define specific Rate Limiting policies for each Consumer represented by its API Key.
Kong Consumer Policies Itâ€™s important then to be able to define specific policies for each one of these consumers. For example, it would be great to define Rate Limiting policies for different consumers like this:">
    <meta property="og:locale" content="en_us">
    <meta property="og:type" content="article">
    <meta property="article:section" content="Kong AI Gateway">
    <meta itemprop="name" content="AI Rate Limiting Advanced plugin :: API Management with Kong Konnect">
    <meta itemprop="description" content="With the existing API Key policy, we can control the incoming requests. However, the policies implemented by the other plugins are the same regardless the consumer.
In this section, we are going to define specific Rate Limiting policies for each Consumer represented by its API Key.
Kong Consumer Policies Itâ€™s important then to be able to define specific policies for each one of these consumers. For example, it would be great to define Rate Limiting policies for different consumers like this:">
    <meta itemprop="wordCount" content="1708">
    <title>AI Rate Limiting Advanced plugin :: API Management with Kong Konnect</title>
    <link href="/css/auto-complete/auto-complete.min.css?1754497601" rel="stylesheet">
    <script src="/js/auto-complete/auto-complete.min.js?1754497601" defer></script>
    <script src="/js/search-lunr.js?1754497601" defer></script>
    <script src="/js/search.js?1754497601" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.index_js_url="/searchindex.en.js?1754497601";
    </script>
    <script src="/js/lunr/lunr.min.js?1754497601" defer></script>
    <script src="/js/lunr/lunr.stemmer.support.min.js?1754497601" defer></script>
    <script src="/js/lunr/lunr.multi.min.js?1754497601" defer></script>
    <script src="/js/lunr/lunr.en.min.js?1754497601" defer></script>
    <script>
      window.relearn = window.relearn || {};
      window.relearn.contentLangs=['en'];
    </script>
    <link href="/fonts/fontawesome/css/fontawesome-all.min.css?1754497601" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="/fonts/fontawesome/css/fontawesome-all.min.css?1754497601" rel="stylesheet"></noscript>
    <link href="/css/perfect-scrollbar/perfect-scrollbar.min.css?1754497601" rel="stylesheet">
    <link href="/css/theme.css?1754497601" rel="stylesheet">
    <link href="/css/format-html.css?1754497601" rel="stylesheet" id="R-format-style">
    <script>
      window.relearn = window.relearn || {};
      // configuration
      window.relearn.min = ``;
      window.relearn.path='\/16-ai-gateway\/17-use-cases\/158-rate-limiting\/index.html';
      window.relearn.relBasePath='..\/..\/..';
      window.relearn.relBaseUri='..\/..\/..';
      window.relearn.absBaseUri='http:\/\/localhost:1313';
      window.relearn.disableAnchorCopy=false;
      window.relearn.disableAnchorScrolling=false;
      window.relearn.disableInlineCopyToClipboard=false;
      window.relearn.enableBlockCodeWrap=true;
      // legal
      window.relearn.getItem = (s,n) => {return s.getItem(n)};
      window.relearn.setItem = (s,n,v) => {return s.setItem(n,v)};
      window.relearn.removeItem = (s,n) => {return s.removeItem(n)};
      // translations
      window.T_Copy_to_clipboard = `Copy to clipboard`;
      window.T_Copied_to_clipboard = `Copied to clipboard!`;
      window.T_Copy_link_to_clipboard = `Copy link to clipboard`;
      window.T_Link_copied_to_clipboard = `Copied link to clipboard!`;
      window.T_Reset_view = `Reset view`;
      window.T_View_reset = `View reset!`;
      window.T_No_results_found = `No results found for "{0}"`;
      window.T_N_results_found = `{1} results found for "{0}"`;
      // variant stuff
      window.relearn.themevariants = [ 'blue' ];
      window.relearn.customvariantname = "my-custom-variant";
      window.relearn.changeVariant = function(variant) {
        var oldVariant = document.documentElement.dataset.rThemeVariant;
        window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        document.documentElement.dataset.rThemeVariant = variant;
        if (oldVariant != variant) {
          document.dispatchEvent( new CustomEvent('themeVariantLoaded', { detail: { variant, oldVariant } }) );
          window.relearn.markVariant();
        }
      }
      window.relearn.markVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant");
        document.querySelectorAll(".R-variantswitcher select").forEach((select) => {select.value = variant;});
      }
      window.relearn.initVariant = function() {
        var variant = window.relearn.getItem(window.localStorage, window.relearn.absBaseUri + "/variant") ?? "";
        if( variant == window.relearn.customvariantname ){
        }else if( !variant || !window.relearn.themevariants.includes(variant) ){
          variant = window.relearn.themevariants[0];
          window.relearn.setItem(window.localStorage, window.relearn.absBaseUri + "/variant", variant);
        }
        document.documentElement.dataset.rThemeVariant = variant;
      }
      window.relearn.initVariant();
      window.relearn.markVariant();
    </script>
  </head>
  <body class="mobile-support html" data-url="/16-ai-gateway/17-use-cases/158-rate-limiting/index.html">
    <div id="R-body" class="default-animation">
      <div id="R-body-overlay"></div>
      <nav id="R-topbar">
        <div class="topbar-wrapper">
          <div class="topbar-sidebar-divider"></div>
          <div class="topbar-area topbar-area-start" data-area="start">
            <div class="topbar-button topbar-button-sidebar" data-content-empty="disable" data-width-s="show" data-width-m="hide" data-width-l="hide"><button class="topbar-control" onclick="toggleNav()" type="button" title="Menu (CTRL&#43;ALT&#43;n)"><i class="fa-fw fas fa-bars"></i></button>
            </div>
            <div class="topbar-button topbar-button-toc" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="Table of Contents (CTRL&#43;ALT&#43;t)"><i class="fa-fw fas fa-list-alt"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
<nav class="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#kong-consumer-policies">Kong Consumer Policies</a></li>
      </ul>
    </li>
  </ul>
</nav>
                </div>
              </div>
            </div>
          </div>
          <ol class="topbar-breadcrumbs breadcrumbs highlightable" itemscope itemtype="http://schema.org/BreadcrumbList"><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><a itemprop="item" href="/index.html"><span itemprop="name">API Management with Kong Konnect</span></a><meta itemprop="position" content="1">&nbsp;>&nbsp;</li><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><a itemprop="item" href="/16-ai-gateway/index.html"><span itemprop="name">Kong AI Gateway</span></a><meta itemprop="position" content="2">&nbsp;>&nbsp;</li><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><a itemprop="item" href="/16-ai-gateway/17-use-cases/index.html"><span itemprop="name">Use Cases</span></a><meta itemprop="position" content="3">&nbsp;>&nbsp;</li><li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement" class=""><span itemprop="name">AI Rate Limiting Advanced plugin</span><meta itemprop="position" content="4"></li>
          </ol>
          <div class="topbar-area topbar-area-end" data-area="end">
            <div class="topbar-button topbar-button-prev" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/16-ai-gateway/17-use-cases/157-apikey/index.html" title="Key Auth Plugin (ðŸ¡)"><i class="fa-fw fas fa-chevron-left"></i></a>
            </div>
            <div class="topbar-button topbar-button-next" data-content-empty="disable" data-width-s="show" data-width-m="show" data-width-l="show"><a class="topbar-control" href="/16-ai-gateway/17-use-cases/159-ai-proxy-advanced/index.html" title="AI Proxy Advanced plugin (ðŸ¡’)"><i class="fa-fw fas fa-chevron-right"></i></a>
            </div>
            <div class="topbar-button topbar-button-more" data-content-empty="hide" data-width-s="show" data-width-m="show" data-width-l="show"><button class="topbar-control" onclick="toggleTopbarFlyout(this)" type="button" title="More"><i class="fa-fw fas fa-ellipsis-v"></i></button>
              <div class="topbar-content">
                <div class="topbar-content-wrapper">
                  <div class="topbar-area topbar-area-more" data-area="more">
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
      <div id="R-main-overlay"></div>
      <main id="R-body-inner" class="highlightable 16-ai-gateway" tabindex="-1">
        <div class="flex-block-wrapper">
<article class="default">
  <header class="headline">
  </header>

<h1 id="ai-rate-limiting-advanced-plugin">AI Rate Limiting Advanced plugin</h1>

<p>With the existing API Key policy, we can control the incoming requests. However, the policies implemented by the other plugins are the same regardless the consumer.</p>
<p>In this section, we are going to define specific Rate Limiting policies for each Consumer represented by its API Key.</p>
<h3 id="kong-consumer-policies">Kong Consumer Policies</h3>
<p>It&rsquo;s important then to be able to define specific policies for each one of these consumers. For example, it would be great to define Rate Limiting policies for different consumers like this:</p>
<ul>
<li>consumer1:
<ul>
<li>apikey = 123456</li>
<li>rate limiting policy = 500 tokens per minute</li>
</ul>
</li>
<li>consumer2:
<ul>
<li>apikey = 987654</li>
<li>rate limiting policy = 10000 tokens per minute</li>
</ul>
</li>
</ul>
<p>Doing that, the Data Plane is capable to not just protect the Route but to identify the consumer based on the key injected to enforce specific policies to the consumer. Keep in mind that a Consumer might have other plugins also enabled such as <a href="https://docs.konghq.com/hub/kong-inc/tcp-log/" rel="external" target="_blank">TCP Log</a>, etc.</p>
<h4 id="new-consumer-and-ai-rate-limiting-advanced-plugin-policies">New Consumer and AI Rate Limiting Advanced plugin Policies</h4>
<p>Then, create the second <code>consumer2</code>, just like you did with the first one, with the <code>987654</code> key. Both Kong Consumers have the <strong>AI Rate Limiting Advanced</strong> plugin enabled with specific configurations.</p>
<p>:::code{showCopyAction=true showLineNumbers=false language=shell}
cat &gt; ai-key-auth-rate-limiting-advanced.yaml &laquo; &lsquo;EOF&rsquo;
_format_version: &ldquo;3.0&rdquo;
_konnect:
control_plane_name: kong-aws
_info:
select_tags:</p>
<ul>
<li>bedrock
services:</li>
<li>name: service1
host: localhost
port: 32000
routes:
<ul>
<li>name: route1
paths:
<ul>
<li>/bedrock-route
plugins:</li>
<li>name: ai-proxy
instance_name: ai-proxy-bedrock-route
enabled: true
config:
auth:
param_name: &ldquo;allow_override&rdquo;
param_value: &ldquo;false&rdquo;
param_location: &ldquo;body&rdquo;
route_type: llm/v1/chat
model:
provider: bedrock
options:
bedrock:
aws_region: us-west-2</li>
<li>name: key-auth
instance_name: key-auth-bedrock
enabled: true
consumers:</li>
</ul>
</li>
</ul>
</li>
<li>keyauth_credentials:
<ul>
<li>key: &ldquo;123456&rdquo;
username: user1
plugins:</li>
<li>name: ai-rate-limiting-advanced
instance_name: ai-rate-limiting-advanced-consumer1
config:
llm_providers:
<ul>
<li>name: bedrock
window_size:
<ul>
<li>60
limit:</li>
<li>500</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>keyauth_credentials:
<ul>
<li>key: &ldquo;987654&rdquo;
username: user2<br>
plugins:</li>
<li>name: ai-rate-limiting-advanced
instance_name: ai-rate-limiting-advanced-consumer2
config:
llm_providers:
<ul>
<li>name: bedrock
window_size:
<ul>
<li>60
limit:</li>
<li>10000
EOF
:::</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Apply the declaration with decK:
:::code{showCopyAction=true showLineNumbers=false language=shell}
deck gateway reset &ndash;konnect-control-plane-name kong-aws &ndash;konnect-token $PAT -f
deck gateway sync &ndash;konnect-token $PAT ai-key-auth-rate-limiting-advanced.yaml
:::</p>
<h4 id="use-both-kong-consumers">Use both Kong Consumers</h4>
<p>If you will, you can inject both keys to your requests.</p>
<p>:::code{showCopyAction=true showLineNumbers=false language=shell}
curl -i -X POST <br>
&ndash;url $DATA_PLANE_LB/bedrock-route <br>
&ndash;header &lsquo;Content-Type: application/json&rsquo; <br>
&ndash;header &lsquo;apikey: 123456&rsquo; <br>
&ndash;data &lsquo;{
&ldquo;messages&rdquo;: [
{
&ldquo;role&rdquo;: &ldquo;user&rdquo;,
&ldquo;content&rdquo;: &ldquo;Who is Jimi Hendrix?&rdquo;
}
],
&ldquo;model&rdquo;: &ldquo;us.amazon.nova-lite-v1:0&rdquo;
}&rsquo;
:::</p>
<ul>
<li>Expected output</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>HTTP/1.1 200 OK
Content-Type: application/json
Connection: keep-alive
X-AI-RateLimit-Limit-minute-bedrock: 500
X-AI-RateLimit-Remaining-minute-bedrock: 500
Date: Fri, 18 Apr 2025 14:58:51 GMT
Content-Length: 2697
x-amzn-RequestId: 52a2aa58-fe6e-413b-a06c-889922bfdba7
X-Kong-LLM-Model: bedrock/us.amazon.nova-lite-v1:0
X-Kong-Upstream-Latency: 3155
X-Kong-Proxy-Latency: 4
Via: 1.1 kong/3.10.0.1-enterprise-edition
Server: kong/3.10.0.1-enterprise-edition
X-Kong-Request-Id: 9782b97c3b0bda090f928d765214077b

{&#34;usage&#34;:{&#34;completion_tokens&#34;:570,&#34;prompt_tokens&#34;:5,&#34;total_tokens&#34;:575},&#34;choices&#34;:[{&#34;finish_reason&#34;:&#34;stop&#34;,&#34;message&#34;:{&#34;content&#34;:&#34;Jimi Hendrix was an American rock guitarist, singer, and songwriter widely regarded as one of the greatest and most influential guitarists in the history of popular music. Born on November 27, 1942, in Seattle, Washington, he became a pivotal figure in the 1960s psychedelic and hard rock movements.\n\n### Key Aspects of Jimi Hendrix&#39;s Career:\n\n1. **Early Life**:\n   - Hendrix grew up in Seattle and began playing guitar at a young age.\n   - He served in the U.S. Army but was discharged due to a foot injury.\n\n2. **Musical Breakthrough**:\n   - After moving to New York City, Hendrix became part of the vibrant music scene and played with various R&amp;B and soul bands.\n   - He moved to London in 1966, where he formed the Jimi Hendrix Experience with bassist Noel Redding and drummer Mitch Mitchell.\n\n3. **Iconic Albums**:\n   - **\&#34;Are You Experienced\&#34; (1967)**: His debut album, which included hits like \&#34;Purple Haze\&#34; and \&#34;Hey Joe.\&#34;\n   - **\&#34;Axis: Bold as Love\&#34; (1967)**: Showcased his innovative guitar work and songwriting.\n   - **\&#34;Electric Ladyland\&#34; (1968)**: Known for its ambitious and experimental tracks, including \&#34;Voodoo Child (Slight Return)\&#34; and \&#34;All Along the Watchtower.\&#34;\n\n4. **Innovative Techniques**:\n   - Hendrix revolutionized guitar playing with his use of feedback, distortion, and effects pedals.\n   - He was known for his ability to play the guitar with his teeth and behind his back, as well as his use of the wah-wah pedal.\n\n5. **Live Performances**:\n   - Hendrix&#39;s live performances were legendary, characterized by his energetic stage presence and improvisational skills.\n   - Notable performances include his iconic rendition of \&#34;The Star-Spangled Banner\&#34; at the Woodstock Festival in 1969 and his groundbreaking performance at the Monterey Pop Festival in 1967.\n\n6. **Legacy**:\n   - Hendrix&#39;s influence extends beyond rock music, impacting various genres including blues, funk, and heavy metal.\n   - He has been inducted into multiple halls of fame, including the Rock and Roll Hall of Fame and the UK Music Hall of Fame.\n   - Rolling Stone magazine has consistently ranked him among the greatest guitarists of all time.\n\n### Death:\nHendrix died on September 18, 1970, in London, from asphyxiation due to barbiturate overdose. His death occurred just a day after his final concert at the Royal Albert Hall.\n\nJimi Hendrix remains a cultural icon, celebrated for his musical genius and his profound impact on the evolution of rock music.&#34;,&#34;role&#34;:&#34;assistant&#34;},&#34;index&#34;:0}],&#34;object&#34;:&#34;chat.completion&#34;}</code></pre></div>
<p>or</p>
<p>:::code{showCopyAction=true showLineNumbers=false language=shell}
curl -i -X POST <br>
&ndash;url $DATA_PLANE_LB/bedrock-route <br>
&ndash;header &lsquo;Content-Type: application/json&rsquo; <br>
&ndash;header &lsquo;apikey: 987654&rsquo; <br>
&ndash;data &lsquo;{
&ldquo;messages&rdquo;: [
{
&ldquo;role&rdquo;: &ldquo;user&rdquo;,
&ldquo;content&rdquo;: &ldquo;Who is Jimi Hendrix?&rdquo;
}
],
&ldquo;model&rdquo;: &ldquo;us.amazon.nova-lite-v1:0&rdquo;
}&rsquo;
:::</p>
<ul>
<li>Expected output</li>
</ul>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>HTTP/1.1 200 OK
Content-Type: application/json
Connection: keep-alive
X-AI-RateLimit-Limit-minute-bedrock: 10000
X-AI-RateLimit-Remaining-minute-bedrock: 10000
Date: Fri, 18 Apr 2025 14:59:27 GMT
Content-Length: 1670
x-amzn-RequestId: 814f0ce7-a47d-4e70-a6ce-be36e8e1b0b9
X-Kong-LLM-Model: bedrock/us.amazon.nova-lite-v1:0
X-Kong-Upstream-Latency: 2222
X-Kong-Proxy-Latency: 4
Via: 1.1 kong/3.10.0.1-enterprise-edition
Server: kong/3.10.0.1-enterprise-edition
X-Kong-Request-Id: a3a50214d6b82a6343f6e5608e56e633

{&#34;usage&#34;:{&#34;completion_tokens&#34;:330,&#34;prompt_tokens&#34;:5,&#34;total_tokens&#34;:335},&#34;choices&#34;:[{&#34;finish_reason&#34;:&#34;stop&#34;,&#34;message&#34;:{&#34;content&#34;:&#34;Jimi Hendrix was an American rock guitarist, singer, and songwriter widely regarded as one of the greatest and most influential guitarists in the history of popular music. Born on November 27, 1942, in Seattle, Washington, he was a key figure in the evolution of rock music during the 1960s.\n\nHendrix gained fame in the mid-1960s while living in London, where he formed the Jimi Hendrix Experience with bassist Noel Redding and drummer Mitch Mitchell. His groundbreaking technique, which included the innovative use of feedback, distortion, and other effects, along with his virtuosic playing style, set him apart from his contemporaries.\n\nSome of Hendrix&#39;s most iconic songs include \&#34;Purple Haze,\&#34; \&#34;Foxy Lady,\&#34; \&#34;Hey Joe,\&#34; \&#34;All Along the Watchtower,\&#34; and \&#34;Voodoo Child (Slight Return).\&#34; His performances, particularly at the Monterey Pop Festival in 1967, Woodstock in 1969, and the Isle of Wight Festival in 1970, are legendary.\n\nHendrix&#39;s influence extends far beyond his recorded music. He was known for his charismatic stage presence and his ability to push the boundaries of what was possible with the electric guitar. His work has inspired countless musicians across various genres.\n\nTragically, Hendrix&#39;s career was cut short when he died on September 18, 1970, in London, from asphyxiation due to barbiturate overdose. Despite his relatively short career, his impact on music and culture endures, and he continues to be celebrated as a pioneering artist.&#34;,&#34;role&#34;:&#34;assistant&#34;},&#34;index&#34;:0}],&#34;object&#34;:&#34;chat.completion&#34;}</code></pre></div>
<p>Again, test the rate-limiting policy by executing the following command multiple times and observe the rate-limit headers in the response, specially, <code>X-AI-RateLimit-Limit-minute-bedrock</code> and <code>X-AI-RateLimit-Remaining-minute-bedrock</code>:</p>
<p>Now, let&rsquo;s consume it with the Consumer1&rsquo;s API Key. As you can see the Data Plane is processing the Rate Limiting processes independently.</p>
<p>:::code{showCopyAction=true showLineNumbers=false language=shell}
curl -i -X POST <br>
&ndash;url $DATA_PLANE_LB/bedrock-route <br>
&ndash;header &lsquo;Content-Type: application/json&rsquo; <br>
&ndash;header &lsquo;apikey: 123456&rsquo; <br>
&ndash;data &lsquo;{
&ldquo;messages&rdquo;: [
{
&ldquo;role&rdquo;: &ldquo;user&rdquo;,
&ldquo;content&rdquo;: &ldquo;Who is Jimi Hendrix?&rdquo;
}
],
&ldquo;model&rdquo;: &ldquo;us.amazon.nova-lite-v1:0&rdquo;
}&rsquo;
:::</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>HTTP/1.1 200 OK
Content-Type: application/json
Connection: keep-alive
X-AI-RateLimit-Limit-minute-bedrock: 500
X-AI-RateLimit-Remaining-minute-bedrock: 500
Date: Fri, 18 Apr 2025 15:00:53 GMT
Content-Length: 2601
x-amzn-RequestId: 998b5022-e5b2-487f-a3d0-cb19eb8dee77
X-Kong-LLM-Model: bedrock/us.amazon.nova-lite-v1:0
X-Kong-Upstream-Latency: 3287
X-Kong-Proxy-Latency: 4
Via: 1.1 kong/3.10.0.1-enterprise-edition
Server: kong/3.10.0.1-enterprise-edition
X-Kong-Request-Id: ba97994f991645566325aa5468568e72</code></pre></div>
<p>If we keep sending requests using the first API Key, eventually, as expected, we&rsquo;ll get an error code:</p>
<p>:::code{showCopyAction=true showLineNumbers=false language=shell}
curl -i -X POST <br>
&ndash;url $DATA_PLANE_LB/bedrock-route <br>
&ndash;header &lsquo;Content-Type: application/json&rsquo; <br>
&ndash;header &lsquo;apikey: 123456&rsquo; <br>
&ndash;data &lsquo;{
&ldquo;messages&rdquo;: [
{
&ldquo;role&rdquo;: &ldquo;user&rdquo;,
&ldquo;content&rdquo;: &ldquo;Who is Jimi Hendrix?&rdquo;
}
],
&ldquo;model&rdquo;: &ldquo;us.amazon.nova-lite-v1:0&rdquo;
}&rsquo;
:::</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>HTTP/1.1 429 Too Many Requests
Date: Fri, 18 Apr 2025 15:09:57 GMT
Content-Type: application/json; charset=utf-8
Connection: keep-alive
X-AI-RateLimit-Reset: 8
X-AI-RateLimit-Retry-After-minute-bedrock: 8
X-AI-RateLimit-Retry-After: 8
X-AI-RateLimit-Limit-minute-bedrock: 500
X-AI-RateLimit-Remaining-minute-bedrock: 0
X-AI-RateLimit-Reset-minute-bedrock: 8
Content-Length: 67
X-Kong-Response-Latency: 1
Server: kong/3.10.0.1-enterprise-edition
X-Kong-Request-Id: 671b855c4535e7596d22d16cca0e6f10

{&#34;message&#34;:&#34;AI token rate limit exceeded for provider(s): bedrock&#34;}</code></pre></div>
<p>However, the second API Key is still allowed to consume the Kong Route:</p>
<p>:::code{showCopyAction=true showLineNumbers=false language=shell}
curl -i -X POST <br>
&ndash;url $DATA_PLANE_LB/bedrock-route <br>
&ndash;header &lsquo;Content-Type: application/json&rsquo; <br>
&ndash;header &lsquo;apikey: 987654&rsquo; <br>
&ndash;data &lsquo;{
&ldquo;messages&rdquo;: [
{
&ldquo;role&rdquo;: &ldquo;user&rdquo;,
&ldquo;content&rdquo;: &ldquo;Who is Jimi Hendrix?&rdquo;
}
],
&ldquo;model&rdquo;: &ldquo;us.amazon.nova-lite-v1:0&rdquo;
}&rsquo;
:::</p>
<div class="highlight wrap-code" dir="auto"><pre tabindex="0"><code>HTTP/1.1 200 OK
Content-Type: application/json
Connection: keep-alive
X-AI-RateLimit-Limit-minute-bedrock: 10000
X-AI-RateLimit-Remaining-minute-bedrock: 10000
Date: Fri, 18 Apr 2025 15:10:30 GMT
Content-Length: 2287
x-amzn-RequestId: a5ffda3e-0ed0-4958-9134-382dc4cc87e7
X-Kong-LLM-Model: bedrock/us.amazon.nova-lite-v1:0
X-Kong-Upstream-Latency: 2974
X-Kong-Proxy-Latency: 2
Via: 1.1 kong/3.10.0.1-enterprise-edition
Server: kong/3.10.0.1-enterprise-edition
X-Kong-Request-Id: 55c8f21ff35a8043d33ed739ec4aac1c

{&#34;usage&#34;:{&#34;completion_tokens&#34;:480,&#34;prompt_tokens&#34;:5,&#34;total_tokens&#34;:485},&#34;choices&#34;:[{&#34;finish_reason&#34;:&#34;stop&#34;,&#34;message&#34;:{&#34;content&#34;:&#34;Jimi Hendrix was an American rock guitarist, singer, and songwriter widely regarded as one of the greatest and most influential guitarists in the history of popular music. Born on November 27, 1942, in Seattle, Washington, he became a pivotal figure in the 1960s psychedelic and hard rock movements.\n\n### Early Life and Career\n- **Birth Name:** Johnny Allen Hendrix\n- **Early Years:** He grew up in Seattle and began playing guitar at a young age. His early career included stints in various R&amp;B bands in the Southern United States.\n\n### Breakthrough\n- **Move to New York:** Hendrix moved to New York City in 1964 and later to London in 1966, where he found greater success.\n- **The Jimi Hendrix Experience:** In London, he formed the Jimi Hendrix Experience with bassist Noel Redding and drummer Mitch Mitchell.\n\n### Musical Innovations\n- **Guitar Techniques:** Hendrix was known for his innovative use of guitar effects, including distortion, feedback, and wah-wah pedals. He also played the guitar behind his back and with his teeth.\n- **Stage Presence:** His electrifying performances and flamboyant stage presence made him a legend.\n\n### Notable Works\n- **Albums:** Some of his most famous albums include \&#34;Are You Experienced\&#34; (1967), \&#34;Axis: Bold as Love\&#34; (1967), and \&#34;Electric Ladyland\&#34; (1968).\n- **Songs:** Iconic songs include \&#34;Purple Haze,\&#34; \&#34;Hey Joe,\&#34; \&#34;All Along the Watchtower,\&#34; and \&#34;Voodoo Child (Slight Return).\&#34;\n\n### Legacy\n- **Influence:** Hendrix&#39;s influence extends across genres, impacting rock, blues, funk, and jazz musicians.\n- **Death:** Tragically, he died on September 18, 1970, in London, at the age of 27, from an overdose of barbiturates.\n\n### Honors and Recognition\n- **Hall of Fame:** Inducted into the Rock and Roll Hall of Fame in 1990.\n- **Cultural Impact:** His music and persona continue to be celebrated and studied, and he remains a symbol of artistic freedom and innovation.\n\nJimi Hendrix&#39;s contributions to music have left an indelible mark, and his work continues to inspire new generations of musicians and fans alike.&#34;,&#34;role&#34;:&#34;assistant&#34;},&#34;index&#34;:0}],&#34;object&#34;:&#34;chat.completion&#34;}</code></pre></div>
<p>Kong-gratulations! have now reached the end of this module by authenticating the API requests with a key and associating different consumers with policy plans. You can now click <strong>Next</strong> to proceed with the next module.</p>

  <footer class="footline">
  </footer>
</article>
        </div>
      </main>
    </div>
    <aside id="R-sidebar" class="default-animation">
      <div id="R-header-topbar" class="default-animation"></div>
      <div id="R-header-wrapper" class="default-animation">
        <div id="R-header" class="default-animation">
          <a id="R-logo" class="R-default" href="/index.html">
            <div class="logo-title">API Management with Kong Konnect</div>
          </a>
        </div>
        <search><form action="/search/index.html" method="get">
          <div class="searchbox default-animation">
            <button class="search-detail" type="submit" title="Search (CTRL+ALT+f)"><i class="fas fa-search"></i></button>
            <label class="a11y-only" for="R-search-by">Search</label>
            <input data-search-input id="R-search-by" name="search-by" class="search-by" type="search" placeholder="Search...">
            <button class="search-clear" type="button" data-search-clear="" title="Clear search"><i class="fas fa-times" title="Clear search"></i></button>
          </div>
        </form></search>
      </div>
      <div id="R-homelinks" class="default-animation homelinks">
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-homelinks">
          <ul class="space collapsible-menu">
            <li class="" data-nav-id="/index.html"><a class="padding" href="/index.html"><i class="fa-fw fas fa-home"></i> Home</a></li>
          </ul>
        </div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-headercontrols">
          <ul class="">
          </ul>
        </div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
      </div>
      <div id="R-content-wrapper" class="highlightable">
        <div class="R-sidebarmenu R-shortcutmenu-main">
          <ul class="enlarge morespace collapsible-menu">
            <li class="" data-nav-id="/architecture/index.html"><a class="padding" href="/architecture/index.html">Kong Konnect Architectural Overview</a></li>
            <li class="" data-nav-id="/10-pre-requisites/index.html"><a class="padding" href="/10-pre-requisites/index.html">Pre-Requisites</a><ul id="R-subsections-188f3a304b47eda4169b210565024d52" class="collapsible-menu"></ul></li>
            <li class="" data-nav-id="/11-konnect-setup/index.html"><a class="padding" href="/11-konnect-setup/index.html">Konnect Setup</a><ul id="R-subsections-fd457d3a7fac9b2f9cefa5c6c0dae1e7" class="collapsible-menu"></ul></li>
            <li class="" data-nav-id="/12-api-gateway/index.html"><a class="padding" href="/12-api-gateway/index.html">Kong API Gateway</a><ul id="R-subsections-edeba57bcdf65a92672ecb9c5ed9177f" class="collapsible-menu"></ul></li>
            <li class="parent " data-nav-id="/16-ai-gateway/index.html"><a class="padding" href="/16-ai-gateway/index.html">Kong AI Gateway</a><ul id="R-subsections-2f2bf218915a29de3a144cfa324a5fc4" class="collapsible-menu">
            <li class="" data-nav-id="/16-ai-gateway/159-ai-gateway-bedrock/index.html"><a class="padding" href="/16-ai-gateway/159-ai-gateway-bedrock/index.html">AI with Amazon Bedrock</a></li>
            <li class="parent alwaysopen " data-nav-id="/16-ai-gateway/17-use-cases/index.html"><a class="padding" href="/16-ai-gateway/17-use-cases/index.html">Use Cases</a><ul id="R-subsections-2a30b88874758540c08bc7b5dc0b321f" class="collapsible-menu">
            <li class="" data-nav-id="/16-ai-gateway/17-use-cases/150-ai-proxy/index.html"><a class="padding" href="/16-ai-gateway/17-use-cases/150-ai-proxy/index.html">AI Proxy plugin</a></li>
            <li class="alwaysopen " data-nav-id="/16-ai-gateway/17-use-cases/151-prompt-engineering/index.html"><a class="padding" href="/16-ai-gateway/17-use-cases/151-prompt-engineering/index.html">Prompt Engineering</a><ul id="R-subsections-0363202472319e6574b8e953cfd2e962" class="collapsible-menu"></ul></li>
            <li class="" data-nav-id="/16-ai-gateway/17-use-cases/155-request-response-transformer/index.html"><a class="padding" href="/16-ai-gateway/17-use-cases/155-request-response-transformer/index.html">AI Request and Response Transfomer plugins</a></li>
            <li class="" data-nav-id="/16-ai-gateway/17-use-cases/156-semantic-cache/index.html"><a class="padding" href="/16-ai-gateway/17-use-cases/156-semantic-cache/index.html">AI Semantic Cache plugin</a></li>
            <li class="" data-nav-id="/16-ai-gateway/17-use-cases/157-apikey/index.html"><a class="padding" href="/16-ai-gateway/17-use-cases/157-apikey/index.html">Key Auth Plugin</a></li>
            <li class="active " data-nav-id="/16-ai-gateway/17-use-cases/158-rate-limiting/index.html"><a class="padding" href="/16-ai-gateway/17-use-cases/158-rate-limiting/index.html">AI Rate Limiting Advanced plugin</a></li>
            <li class="alwaysopen " data-nav-id="/16-ai-gateway/17-use-cases/159-ai-proxy-advanced/index.html"><a class="padding" href="/16-ai-gateway/17-use-cases/159-ai-proxy-advanced/index.html">AI Proxy Advanced plugin</a><ul id="R-subsections-2fae536c9a93e13a3229a0587c096fc2" class="collapsible-menu"></ul></li>
            <li class="" data-nav-id="/16-ai-gateway/17-use-cases/170-rag/index.html"><a class="padding" href="/16-ai-gateway/17-use-cases/170-rag/index.html">RAG - Retrieval-Augmented Generation</a></li></ul></li></ul></li>
          </ul>
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-shortcuts">
          <ul class="space collapsible-menu">
          </ul>
        </div>
        <div id="R-footer-margin"></div>
        <div class="R-menu-divider default-animation">
          <hr class="padding">
        </div>
        <div class="R-sidebarmenu R-shortcutmenu-footercontrols">
          <ul class="">
          </ul>
        </div>
<div id="R-footer"><p>Built with <a href="https://github.com/McShelby/hugo-theme-relearn" title="love"><i class="fas fa-heart"></i></a> by <a href="https://gohugo.io/">Hugo</a></p></div>
      </div>
    </aside>
    <script src="/js/clipboard/clipboard.min.js?1754497601" defer></script>
    <script src="/js/perfect-scrollbar/perfect-scrollbar.min.js?1754497601" defer></script>
    <script src="/js/theme.js?1754497601" defer></script>
  </body>
</html>
